{"version":3,"sources":["uni-app:///main.js","webpack:///E:/奋斗蜂/github/fighting-bee/fighting-bee/pages/users/wechatLogin/index.vue?4078","webpack:///E:/奋斗蜂/github/fighting-bee/fighting-bee/pages/users/wechatLogin/index.vue?66a8","webpack:///E:/奋斗蜂/github/fighting-bee/fighting-bee/pages/users/wechatLogin/index.vue?ee80","webpack:///E:/奋斗蜂/github/fighting-bee/fighting-bee/pages/users/wechatLogin/index.vue?f6f1","uni-app:///pages/users/wechatLogin/index.vue","webpack:///E:/奋斗蜂/github/fighting-bee/fighting-bee/pages/users/wechatLogin/index.vue?538a","webpack:///E:/奋斗蜂/github/fighting-bee/fighting-bee/pages/users/wechatLogin/index.vue?739d"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","statusBarHeight","isPhoneBox","code","authKey","options","userInfo","codeNum","canUseGetUserProfile","components","routinePhone","onLoad","Routine","then","console","methods","back","uni","home","url","maskClose","getphonenumber","title","catch","getUserPhoneNumber","getUserPhone","encryptedData","iv","spread_spid","spread_code","token","time","icon","tab","getUserInfo","that","setUserInfo","getUserProfile","self","duration","getWxUser"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,cAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACc;;;AAGlE;AACsL;AACtL,gBAAgB,uLAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAisB,CAAgB,iqBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;ACsCrtB;AAGA;AAMA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAfA;AACA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA,eAeA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACAC;EACA;EACAC;IAAA;IACA;MACA;IACA;IACA;IAEAC,2BACAC;MACAC;MACA;IACA;IAEA;IACA;IACA;MACA;IACA;MACA;IACA;EACA;EACAC;IACAC;MACAC;IACA;IACAC;MACAD;QACAE;MACA;IACA;IACA;IACAC;MACA;IACA;IAEA;IACAC;MAAA;MACAJ;QACAK;MACA;MACAV,2BACAC;QACA;MACA,GACAU;QACAN;QACAA;MACA;IACA;IACA;IACAO;MAAA;MACAC;QACAC;QACAC;QACAxB;QACAyB;QACAC;MACA,GACAhB;QACA;QACA;UACAiB;UACAC;QACA;QACA;QACA;QACA;QACA;UACAT;UACAU;QACA;UACAC;QACA;MACA,GACAV;QACAN;MACA;IACA;IACA;AACA;AACA;IACAiB;MACA;MACA;QACAjB;QACAkB;QACAA;UACAb;UACAU;QACA;UACAC;QACA;MACA;IACA;IACAG;MAAA;MAEAnB;QACAK;MACA;MACAV,2BACAC;QACA;MACA,GACAU;QACAN;MACA;IACA;IACA;IACAoB;MAAA;MAEApB;QACAK;MACA;MACA;MACAV,kCACAC;QACA;QACAD;UAAAT;QAAA,GACAU;UACAI;UACA;UACAqB;YACAR;YACAC;UACA;UACAO;YACAhB;YACAU;UACA;YACAC;UACA;QACA,GACAV;UACAN;UACAA;YACAK;YACAU;YACAO;UACA;QACA;MACA,GACAhB;QACAN;MACA;IACA;IACAuB;MACA;MACA5B,+BACAC;QACA;QACAD;UAAAT;QAAA,GACAU;UACAI;UACA;UACAqB;YACAR;YACAC;UACA;UACAO;YACAhB;YACAU;UACA;YACAC;UACA;QACA,GACAV;UACAN;UACAA;YACAK;YACAU;YACAO;UACA;QACA;MACA,GACAhB;QACAN;MACA;IACA;EAGA;AACA;AAAA,2B;;;;;;;;;;;;;ACvPA;AAAA;AAAA;AAAA;AAAwzC,CAAgB,wrCAAG,EAAC,C;;;;;;;;;;;ACA50C;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/users/wechatLogin/index.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/users/wechatLogin/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=1d174576&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/users/wechatLogin/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=1d174576&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n  <view>\r\n    <view class=\"system-height\" :style=\"{ height: statusBarHeight }\"></view>\r\n    <!-- #ifdef MP -->\r\n    <view class=\"title-bar\" style=\"height: 43px;\">\r\n      <view class=\"icon\" @click=\"back\" v-if=\"!isHome\">\r\n        <image src=\"@/static/image/left.png\"></image>\r\n      </view>\r\n      <view class=\"icon\" @click=\"home\" v-else>\r\n        <image src=\"@/static/image/left.png\"></image>\r\n      </view>\r\n      账户登录\r\n    </view>\r\n    <!-- #endif -->\r\n    <view class=\"wechat_login\">\r\n      <view class=\"img\">\r\n        <image src=\"@/static/image/boat.png\" mode=\"widthFix\"></image>\r\n      </view>\r\n      <view class=\"btn-wrapper\">\r\n        <!-- #ifdef MP -->\r\n        <button v-if=\"canUseGetUserProfile && code\" type=\"primary\" hover-class=\"none\" @tap=\"getUserProfile\"\r\n          class=\"bg-green btn1\">微信登录</button>\r\n        <button v-else hover-class=\"none\" type=\"primary\" open-type=\"getUserInfo\" @getuserinfo=\"setUserInfo\"\r\n          class=\"bg-green btn1\">微信登录</button>\r\n        <!-- #endif -->\r\n      </view>\r\n    </view>\r\n    <block v-if=\"isPhoneBox\">\r\n      <routinePhone :isPhoneBox=\"isPhoneBox\" @close=\"bindPhoneClose\" :authKey=\"authKey\">\r\n      </routinePhone>\r\n    </block>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n  const app = getApp();\r\n  let statusBarHeight = uni.getSystemInfoSync().statusBarHeight + 'px';\r\n  import routinePhone from '@/components/loginMobile/index.vue';\r\n  import {\r\n    silenceAuth,\r\n  } from '@/api/public';\r\n  import {\r\n    LOGO_URL,\r\n    EXPIRES_TIME,\r\n    USER_INFO,\r\n    STATE_R_KEY\r\n  } from '@/config/cache';\r\n  import {\r\n    getUserInfo\r\n  } from '@/api/user.js';\r\n  import Routine from '@/libs/routine';\r\n  export default {\r\n    data() {\r\n      return {\r\n        statusBarHeight: statusBarHeight,\r\n        isPhoneBox: false,\r\n        code: '',\r\n        authKey: '',\r\n        options: '',\r\n        userInfo: {},\r\n        codeNum: 0,\r\n        canUseGetUserProfile: false\r\n      };\r\n    },\r\n    components: {\r\n      routinePhone\r\n    },\r\n    onLoad(options) {\r\n      if (uni.getUserProfile) {\r\n        this.canUseGetUserProfile = true\r\n      }\r\n      let that = this;\r\n      // #ifdef MP\r\n      Routine.getCode()\r\n        .then(code => {\r\n          console.log(code)\r\n          this.code = code\r\n        })\r\n      // #endif\r\n      let pages = getCurrentPages();\r\n      let prePage = pages[pages.length - 2];\r\n      if (prePage && prePage.route == 'pages/user/bookBoat/component/BookSuccess') {\r\n        this.isHome = true;\r\n      } else {\r\n        this.isHome = false;\r\n      }\r\n    },\r\n    methods: {\r\n      back() {\r\n        uni.navigateBack();\r\n      },\r\n      home() {\r\n        uni.navigateTo({\r\n          url: '/pages/user/bookBoat/index'\r\n        })\r\n      },\r\n      // 弹窗关闭\r\n      maskClose() {\r\n        this.isUp = false;\r\n      },\r\n      // #ifdef MP\r\n      // 小程序获取手机号码\r\n      getphonenumber(e) {\r\n        uni.showLoading({\r\n          title: '正在登录中'\r\n        });\r\n        Routine.getCode()\r\n          .then(code => {\r\n            this.getUserPhoneNumber(e.detail.encryptedData, e.detail.iv, code);\r\n          })\r\n          .catch(error => {\r\n            uni.$emit('closePage', false);\r\n            uni.hideLoading();\r\n          });\r\n      },\r\n      // 小程序获取手机号码回调\r\n      getUserPhoneNumber(encryptedData, iv, code) {\r\n        getUserPhone({\r\n            encryptedData: encryptedData,\r\n            iv: iv,\r\n            code: code,\r\n            spread_spid: app.globalData.spid,\r\n            spread_code: app.globalData.code\r\n          })\r\n          .then(res => {\r\n            let time = res.data.expires_time - this.$Cache.time();\r\n            this.$store.commit('LOGIN', {\r\n              token: res.data.token,\r\n              time: time\r\n            });\r\n            this.userInfo = res.data.userInfo;\r\n            this.$store.commit('UPDATE_USERINFO', res.data.userInfo);\r\n            this.$Cache.clear('snsapiKey');\r\n            this.$util.Tips({\r\n              title: '登录成功',\r\n              icon: 'success'\r\n            }, {\r\n              tab: 3\r\n            });\r\n          })\r\n          .catch(res => {\r\n            uni.hideLoading();\r\n          });\r\n      },\r\n      /**\r\n       * 获取个人用户信息\r\n       */\r\n      getUserInfo: function() {\r\n        let that = this;\r\n        getUserInfo().then(res => {\r\n          uni.hideLoading();\r\n          that.userInfo = res.data;\r\n          that.$util.Tips({\r\n            title: '登录成功',\r\n            icon: 'success'\r\n          }, {\r\n            tab: 3\r\n          });\r\n        });\r\n      },\r\n      setUserInfo(e) {\r\n        \r\n        uni.showLoading({\r\n          title: '正在登录中'\r\n        });\r\n        Routine.getCode()\r\n          .then(code => {\r\n            this.getWxUser(code);\r\n          })\r\n          .catch(res => {\r\n            uni.hideLoading();\r\n          });\r\n      },\r\n      //小程序授权api替换 getUserInfo\r\n      getUserProfile() {\r\n        \r\n        uni.showLoading({\r\n          title: '正在登录中'\r\n        });\r\n        let self = this;\r\n        Routine.getUserProfile()\r\n          .then(res => {\r\n            let userInfo = res.userInfo;\r\n            Routine.authUserInfo({code: this.code})\r\n              .then(res => {\r\n                uni.hideLoading();\r\n                let time = res.expires_time - self.$Cache.time();\r\n                self.$store.commit('LOGIN', {\r\n                  token: res.token,\r\n                  time: time\r\n                });\r\n                self.$util.Tips({\r\n                  title: '登录成功',\r\n                  icon: 'success'\r\n                }, {\r\n                  tab: 3,\r\n                });\r\n              })\r\n              .catch(res => {\r\n                uni.hideLoading();\r\n                uni.showToast({\r\n                  title: res.msg,\r\n                  icon: 'none',\r\n                  duration: 2000\r\n                });\r\n              });\r\n          })\r\n          .catch(res => {\r\n            uni.hideLoading();\r\n          });\r\n      },\r\n      getWxUser(code) {\r\n        let self = this;\r\n        Routine.getUserInfo()\r\n          .then(res => {\r\n            let userInfo = res.userInfo;\r\n            Routine.authUserInfo({code: code})\r\n              .then(res => {\r\n                uni.hideLoading();\r\n                let time = res.expires_time - self.$Cache.time();\r\n                self.$store.commit('LOGIN', {\r\n                  token: res.token,\r\n                  time: time\r\n                });\r\n                self.$util.Tips({\r\n                  title: res.msg,\r\n                  icon: 'success'\r\n                }, {\r\n                  tab: 3\r\n                });\r\n              })\r\n              .catch(res => {\r\n                uni.hideLoading();\r\n                uni.showToast({\r\n                  title: res.msg,\r\n                  icon: 'none',\r\n                  duration: 2000\r\n                });\r\n              });\r\n          })\r\n          .catch(res => {\r\n            uni.hideLoading();\r\n          });\r\n      },\r\n\r\n      // #endif\r\n    }\r\n  };\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n  page {\r\n    background: #fff;\r\n  }\r\n\r\n  .wechat_login {\r\n\r\n    .img image {\r\n      width: 100%;\r\n    }\r\n\r\n    .btn-wrapper {\r\n      margin-top: 86rpx;\r\n      padding: 0 66rpx;\r\n\r\n      button {\r\n        width: 100%;\r\n        height: 86rpx;\r\n        line-height: 86rpx;\r\n        margin-bottom: 40rpx;\r\n        border-radius: 120rpx;\r\n        font-size: 30rpx;\r\n\r\n        &.btn1 {\r\n          color: #fff;\r\n        }\r\n\r\n        &.btn2 {\r\n          color: #666666;\r\n          border: 1px solid #666666;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .title-bar {\r\n    position: relative;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    font-size: 36rpx;\r\n  }\r\n\r\n  .icon {\r\n    position: absolute;\r\n    left: 0rpx;\r\n    top: 0;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: 86rpx;\r\n    height: 86rpx;\r\n\r\n    image {\r\n      width: 50rpx;\r\n      height: 50rpx;\r\n    }\r\n  }\r\n</style>","import mod from \"-!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1740970305016\n      var cssReload = require(\"E:/hbuilderx/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}